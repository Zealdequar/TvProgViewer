using System;
using System.Collections.Generic;
using System.Data.Common;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using TVProgViewer.BusinessLogic.ProgObjs;
using TVProgViewer.Common;

namespace TVProgViewer.DataAccess.Adapters
{
    public class TvProgAdapter: AdapterBase
    {
        private static Func<DbDataReader, ProviderType> getTvProviderTypeFunc = r =>
            {
                return new ProviderType()
                {
                    TVProgProviderID = r.GetIntOrDefault("TVProgProviderID"),
                    ProviderName = r.GetStringOrDefault("ProviderName"),
                    ProviderUri = new Uri(r.GetStringOrDefault("ProviderWebSite")),
                    TypeProgID = r.GetIntOrDefault("TypeProgID"),
                    TypeEnum = (r.GetStringOrDefault("TypeName") == "Формат XMLTV") ?
                           Enums.TypeProg.XMLTV :
                           Enums.TypeProg.InterTV,
                    TypeName = r.GetStringOrDefault("TypeName"),
                    FileFormat = r.GetStringOrDefault("FileFormat")
                };
            };
        
        public static List<ProviderType> GetTvProviderTypes()
        {
            return DataAccess.ExecReaderCommand<ProviderType>(
                GetTvProgMainConnection(),
                "spGetTVProviderAndTypes",
                (DbParameter)null,
                getTvProviderTypeFunc);
        }
    }
}
