function fillSelects(){$.ajax({url:"/Programme/GetTvProviderList",dataType:"json",async:!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t;for($("#TVProgType").empty(),t=0;t<n.length;t++)$("#TVProgProvider option").filter(function(){return $(this).html()===n[t].ProviderName}).val()||$("#TVProgProvider").append($("<option>",{value:n[t].TVProgProviderID}).text(n[t].ProviderName));for(t=0;t<n.length;t++)!$("#TVProgType option").filter(function(){return $(this).html()===n[t].TypeProgID}).val()&&$("#TVProgProvider option:selected").filter(function(){return $(this).html()===n[t].ProviderName}).val()&&$("#TVProgType").append($("<option>",{value:n[t].TypeProgID}).text(n[t].TypeName))},error:function(n,t){var i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText}});$.ajax({url:"/Programme/GetCategories",dataType:"json",async:!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){$("#TVProgCategories").empty();$("#TVProgCategories").append($("<option>",{value:"null"}).text("Все категории"));for(var t=1;t<n.length;t++)$("#TVProgCategories").append($("<option>",{value:n[t]}).text(n[t]))}})}function fillFooter(){$("#TVProgType option:selected")&&$("#TVProgType option:selected").val()&&$.ajax({url:"/Programme/GetSystemProgrammePeriod?progType="+$("#TVProgType option:selected").val(),dataType:"json",type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t=new Date(parseInt(n.dtStart.substr(6))),i=new Date(parseInt(n.dtEnd.substr(6)));$("#period").text(formatDateString(t)+" — "+formatDateString(i))}})}function formatDateString(n){var t=("0"+n.getDate()).slice(-2),i=("0"+(n.getMonth()+1)).slice(-2),r=n.getFullYear();return t+"."+i+"."+r}function numDateString(n){var t=("0"+n.getDate()).slice(-2),i=("0"+(n.getMonth()+1)).slice(-2),r=n.getFullYear();return r+""+i+""+t}function getImgTag(n,t){return"<img src='"+n+"' alt='"+t+"' />"}function imgRating(n){return n?getImgTag(n,"Рейтинг"):" "}function imgGenre(n){return n?getImgTag(n,"Жанр"):" "}function imgAnons(n){return n?getImgTag(n,"Анонс"):" "}function imgChannel(n){return n?getImgTag(n,"Эмблема канала"):"<img src='/images/i/satellite_25.png' alt='Эмблема канала' />"}function setGrids(){$("#TVProgrammeNowGrid").jqGrid({url:"/Programme/GetSystemProgrammeAtNow?progType="+$("#TVProgType option:selected").val()+"&category="+$("#TVProgCategories option:selected").val()+"&genres="+GetGenres(".btn-genre-now.active"),datatype:"json",mtype:"Get",success:function(){},colNames:["Рейтинг","Название рейтинга","Жанр","Название жранра","Анонс","Эмблема канала","Название канала","Передача","Начало","Окончание","Осталось, %",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:"2%",align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:"2%",align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:"2%",align:"center",formatter:imgAnons},{key:!1,name:"ChannelContent",index:"ChannelContent",sortable:!0,width:"3%",align:"center",formatter:imgChannel},{key:!1,name:"ChannelName",index:"ChannelName",sortable:!0,width:"5%"},{key:!1,name:"TelecastTitle",index:"TelecastTitle",sortable:!0,width:"20%"},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:"3%",sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:"3%",sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Remain",index:"Remain",sortable:!0,width:"5%",formatter:function(n){return"<div style='position: relative'><div style='text-align: center; position: absolute; top: 1px; left: 42%; right: 42%; z-index: 1000'>"+n+"%<\/div><div class='progress-bar progress-bar-striped' role='progressbar' aria-valuemin='100' aria-valuemax='1' style='width: "+n+"%; position: relative; height: 20px;'><\/div><\/div>"}},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeNowGrid").jqGrid("resetSelection"),!0},loadComplete:function(){$("tr.jqgrow:odd").css("background","#EFFFEF");$("tr.jqgrow td input","#TVProgrammeNowGrid").click(function(){$(this).closest("tr").find("td:nth-child(4)").find("img").length?($("#mainToolNow").show(50),$("#anonsTool").show(50),$("#anonsDescr").html($(this).closest("tr").find("td:nth-child(13)").attr("title"))):($("#anonsTool").hide(50),$("#mainToolNow").hide(50),$("#anonsDescr").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,autoResizing:{minColWidth:80},viewrecords:!0,caption:"Программа передач",emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammePager",loadonce:!1,forceClientSorting:!0,multiselect:!0}).navGrid("#TVProgrammePager",{edit:!1,add:!1,del:!1,search:!0,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]});jQuery("#TVProgrammeNowGrid").jqGrid("hideCol","GenreName");jQuery("#TVProgrammeNowGrid").jqGrid("hideCol","RatingName");uv==0&&jQuery("#TVProgrammeNowGrid").jqGrid("hideCol","RatingContent");$("#TVProgrammeNextGrid").jqGrid({url:"/Programme/GetSystemProgrammeAtNext?progType="+$("#TVProgType option:selected").val()+"&category="+$("#TVProgCategories option:selected").val()+"&genres="+GetGenres(".btn-genre-next.active"),datatype:"json",mtype:"Get",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","Эмблема канала","Название канала","Передача","Начало","Окончание","Осталось",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:40,align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:40,align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:40,align:"center",formatter:imgAnons},{key:!1,name:"ChannelContent",index:"ChannelContent",sortable:!0,width:80,align:"center",formatter:imgChannel},{key:!1,name:"ChannelName",index:"ChannelName",sortable:!0},{key:!1,name:"TelecastTitle",index:"TelecastTitle",width:520,sortable:!0},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Remain",index:"Remain",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:function(n,t,i,r){return $.fn.fmatter.call(this,"date",new Date(n*1e3-108e5),$.extend({},$.jgrid.formatter.date,t),i,r)},formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeNextGrid").jqGrid("resetSelection"),!0},loadComplete:function(){$("tr.jqgrow:odd").css("background","#EFFFEF");$("tr.jqgrow td input","#TVProgrammeNextGrid").click(function(){$(this).closest("tr").find("td:nth-child(4)").find("img").length?($("#mainToolNext").show(50),$("#anonsToolNext").show(50),$("#anonsDescrNext").html($(this).closest("tr").find("td:nth-child(13)").attr("title"))):($("#mainToolNext").hide(50),$("#anonsToolNext").hide(50),$("#anonsDescrNext").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,autoResizing:{minColWidth:80},viewrecords:!0,caption:"Программа передач",emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammeNextPager",loadonce:!1,multiselect:!0}).navGrid("#TVProgrammeNextPager",{edit:!1,add:!1,del:!1,search:!0,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]});jQuery("#TVProgrammeNextGrid").jqGrid("hideCol","GenreName");jQuery("#TVProgrammeNextGrid").jqGrid("hideCol","RatingName");uv==0&&jQuery("#TVProgrammeNextGrid").jqGrid("hideCol","RatingContent")}function searchProgramme(n,t){$("#SearchedTVProgramme").jqGrid("GridUnload");$("#SearchedTVProgramme").jqGrid({url:"/Programme/SearchProgramme?progType="+n+"&findTitle="+t+"&category="+$("#TVProgCategories option:selected").val()+"&genres="+GetGenres(".btn-genre-search.active")+"&dates="+GetDates(".chkDates:checkbox:checked"),datatype:"json",mtype:"Get",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","Эмблема канала","Название канала","День","От","До","Передачи"],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:40,align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:"46px",align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:"43px",align:"center",formatter:imgAnons},{key:!1,name:"ChannelContent",index:"ChannelContent",sortable:!0,align:"center",formatter:imgChannel},{key:!1,name:"ChannelName",index:"ChannelName",sortable:!0},{key:!1,name:"DayMonth",index:"DayMonth",sortable:!0,align:"center",width:100},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:55,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:55,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastTitle",index:"TelecastTitle",sortable:!0,width:556},],rowNum:20,beforeSelectRow:function(){return $("#SearchedTVProgramme").jqGrid("resetSelection"),!0},loadComplete:function(){$("tr.jqgrow:odd").css("background","#EFFFEF");$("tr.jqgrow td input","#SearchedTVProgramme").click(function(){$(this).closest("tr").find("td:nth-child(4)").find("img").length?($("#mainToolSearch").show(50),$("#anonsToolSearch").show(50),$("#anonsDescrSearch").html($(this).closest("tr").find("td:nth-child(13)").attr("title"))):($("#anonsToolSearch").hide(50),$("#mainToolSearch").hide(50),$("#anonsDescrSearch").hide(150))})},afterInsertRow:function(n,t){var i=new Date(1970,0,1,3,0,0),r;i.setMilliseconds(t.Stop.substring(6,t.Stop.length-2));r=new Date;r>i?$(this).jqGrid("setRowData",n,!1,{color:"#696969"}):$(this).jqGrid("setRowData",n,!1,{color:"#000"})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,viewrecords:!0,caption:"Программа передач",emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammeSearchPager",loadonce:!1,forceClientSorting:!0,multiselect:!0}).navGrid("#TVProgrammeSearchPager",{edit:!1,add:!1,del:!1,search:!0,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]});jQuery("#SearchedTVProgramme").jqGrid("hideCol","GenreName");jQuery("#SearchedTVProgramme").jqGrid("hideCol","RatingName");uv==0&&jQuery("#SearchedTVProgramme").jqGrid("hideCol","RatingContent")}function setTree(n){var t="/Tree/GetTreeData?providerId="+$("#TVProgProvider option:selected").val()+"&typeProg="+$("#TVProgType option:selected").val()+"&mode="+(n-1);n===2?($("#containerByDays").jstree({core:{data:{url:t,dataType:"json"}}}),$("#containerByDays").jstree(!0).settings.core.data.url=t,$("#containerByDays").jstree("refresh")):n===3&&($("#containerByChannels").jstree({core:{data:{url:t,dataType:"json"}}}),$("#containerByChannels").jstree(!0).settings.core.data.url=t,$("#containerByChannels").jstree("refresh"))}function getSelectedTabIndex(){return idx}function fillUserByDay(n,t){$("#TVProgrammeByDaysGrid").jqGrid("GridUnload");$("#TVProgrammeByDaysGrid").jqGrid({url:"/Programme/GetUserProgrammeOfDay?progTypeID="+$("#TVProgType option:selected").val()+"&cid="+t+"&tsDate="+n+"&category="+$("#TVProgCategories option:selected").val(),datatype:"json",mtype:"Get",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","От","До","Передача",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:40,align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:40,align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:40,align:"center",formatter:imgAnons},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastTitle",index:"TelecastTitle",width:850,sortable:!0},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeByDaysGrid").jqGrid("resetSelection"),!0},afterInsertRow:function(n,t){var u=new Date(1970,0,1,3,0,0),r,i;u.setMilliseconds(t.Start.substring(6,t.Start.length-2));r=new Date(1970,0,1,3,0,0);r.setMilliseconds(t.Stop.substring(6,t.Stop.length-2));i=new Date;r<i&&$(this).jqGrid("setRowData",n,!1,{color:"#696969"});u<=i&&r>i&&$(this).jqGrid("setRowData",n,!1,{color:"#000"});u>i&&$(this).jqGrid("setRowData",n,!1,{color:"#006400"})},loadComplete:function(){$("tr.jqgrow:odd").css("background","#EFFFEF");$("tr.jqgrow td input","#TVProgrammeByDaysGrid").click(function(){$(this).closest("tr").find("td:nth-child(4)").find("img").length?($("#anonsToolByDays").show(50),$("#anonsDescrByDays").html($(this).closest("tr").find("td:nth-child(10)").attr("title"))):($("#anonsToolByDays").hide(50),$("#anonsDescrByDays").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,viewrecords:!0,caption:"Программа передач",shrinkToFit:!0,emptyrecords:"Программа передач не обнаружена",jsonReader:{repeatitems:!1,root:function(n){return n},page:function(){return 1},total:function(n){return n.rowNum/n.height},records:function(n){return n.length}},pager:"#TVProgrammeByDaysPager",loadonce:!0,multiselect:!0}).navGrid("#TVProgrammeByDaysPager",{edit:!1,add:!1,del:!1,search:!0,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]});jQuery("#TVProgrammeByDaysGrid").jqGrid("hideCol","GenreName");jQuery("#TVProgrammeByDaysGrid").jqGrid("hideCol","RatingName");uv==0&&jQuery("#TVProgrammeByDaysGrid").jqGrid("hideCol","RatingContent")}function fillUserByChannels(n,t){$("#TVProgrammeByChannelsGrid").jqGrid("GridUnload");$("#TVProgrammeByChannelsGrid").jqGrid({url:"/Programme/GetUserProgrammeOfDay?progTypeID="+$("#TVProgType option:selected").val()+"&cid="+t+"&tsDate="+n+"&category="+$("#TVProgCategories option:selected").val(),datatype:"json",mtype:"Get",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","От","До","Передача",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:40,align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:40,align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:40,align:"center",formatter:imgAnons},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastTitle",index:"TelecastTitle",width:850,sortable:!0},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeByChannelsGrid").jqGrid("resetSelection"),!0},afterInsertRow:function(n,t){var u=new Date(1970,0,1,3,0,0),r,i;u.setMilliseconds(t.Start.substring(6,t.Start.length-2));r=new Date(1970,0,1,3,0,0);r.setMilliseconds(t.Stop.substring(6,t.Stop.length-2));i=new Date;r<i&&$(this).jqGrid("setRowData",n,!1,{color:"#696969"});u<=i&&r>i&&$(this).jqGrid("setRowData",n,!1,{color:"#000"});u>i&&$(this).jqGrid("setRowData",n,!1,{color:"#006400"})},loadComplete:function(){$("tr.jqgrow:odd").css("background","#EFFFEF");$("tr.jqgrow td input","#TVProgrammeByChannelsGrid").click(function(){$(this).closest("tr").find("td:nth-child(4)").find("img").length?($("#anonsToolByChannels").show(50),$("#anonsDescrByChannels").html($(this).closest("tr").find("td:nth-child(10)").attr("title"))):($("#anonsToolByChannels").hide(50),$("#anonsDescrByChannels").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,viewrecords:!0,caption:"Программа передач",emptyrecords:"Программа передач не обнаружена",jsonReader:{repeatitems:!1,root:function(n){return n},page:function(){return 1},total:function(n){return n.rowNum/n.height},records:function(n){return n.length}},pager:"#TVProgrammeByChannelsPager",loadonce:!0,multiselect:!0}).navGrid("#TVProgrammeByChannelsPager",{edit:!1,add:!1,del:!1,search:!0,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]});jQuery("#TVProgrammeByChannelsGrid").jqGrid("hideCol","GenreName");jQuery("#TVProgrammeByChannelsGrid").jqGrid("hideCol","RatingName");uv==0&&jQuery("#TVProgrammeByChannelsGrid").jqGrid("hideCol","RatingContent")}function GetGenres(n){var t=$(n).map(function(){return this.id}).get();return t.join(";")}function GetDates(n){var t=$(n).map(function(){return this.id.replace("Date","")}).get();return t.join(";")}function fillGenresToolNow(){$.ajax({url:"/Programme/GetGenres",dataType:"json",async:!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t,i;for($("#genresToolNow").empty(),t=0;t<n.length;t++)i=$('<button id="'+n[t].GenreID+'" class="btn btn-default btn-genre-now">'),$("#genresToolNow").append(i.html('<img src="'+n[t].GenrePath+'" title="'+n[t].GenreName+'" height="24px" width="24px">'));$(".btn-group-genres-now").on("click",".btn",function(n){n.preventDefault();$(this).toggleClass("active");$("#TVProgrammeNowGrid").jqGrid("GridUnload");setGrids()})},error:function(n,t){var i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText}})}function fillGenresToolNext(){$.ajax({url:"/Programme/GetGenres",dataType:"json",async:!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t,i;for($("#genresToolNext").empty(),t=0;t<n.length;t++)i=$('<button id="'+n[t].GenreID+'" class="btn btn-default btn-genre-next">'),$("#genresToolNext").append(i.html('<img src="'+n[t].GenrePath+'" title="'+n[t].GenreName+'" height="24px" width="24px">'));$(".btn-group-genres-next").on("click",".btn",function(n){n.preventDefault();$(this).toggleClass("active");$("#TVProgrammeNextGrid").jqGrid("GridUnload");setGrids()})},error:function(n,t){var i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText}})}function fillGenresToolSearch(){$.ajax({url:"/Programme/GetGenres",dataType:"json",async:!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t,i;for($("#genresToolSearch").empty(),t=0;t<n.length;t++)i=$('<button id="'+n[t].GenreID+'" class="btn btn-default btn-genre-search">'),$("#genresToolSearch").append(i.html('<img src="'+n[t].GenrePath+'" title="'+n[t].GenreName+'" height="24px" width="24px">'));$(".btn-group-genres-search").on("click",".btn",function(n){n.preventDefault();$(this).toggleClass("active");$("#SearchedTVProgramme").jqGrid("GridUnload");setGrids()})},error:function(n,t){var i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText}})}function fillDatesToolSearch(){$("#TVProgType option:selected")&&$("#TVProgType option:selected").val()&&$.ajax({url:"/Programme/GetSystemProgrammePeriod?progType="+$("#TVProgType option:selected").val(),dataType:"json",type:"Get",contentType:"application/json; charset=utf-8",success:function(n){for(var r=new Date(parseInt(n.dtStart.substr(6))),u=new Date(parseInt(n.dtEnd.substr(6))),i=getDates(r,u),t=1;t<=7;t++)$("#datesToolSearch").append('<div class="row">'+appendDateColumn(i[(t-1)%7])+appendDateColumn(i[(t-1)%7+7])+appendDateColumn(i[(t-1)%7+14])+appendDateColumn(i[(t-1)%7+21])+appendDateColumn(i[(t-1)%7+28])+appendDateColumn(i[(t-1)%7+35])+"<\/div>")}})}function appendDateColumn(n){var t=new Date,i=new Date(t.getFullYear(),t.getMonth(),t.getDate()).valueOf(),r=new Date(n),u=r>=i?'checked="checked" ':"";return'<div class="col-sm-2"><div class="form-group form-check">'+(typeof n!="undefined"?'<input id="Date'+numDateString(n)+'" type="checkbox" '+u+'class="form-check-input chkDates">':"")+(typeof n!="undefined"?'<label class="form-check-label label-of-checkbox" for="Date'+numDateString(n)+'"><img class="pic-of-checkbox" src="/imgs/i/'+getDayOfWeek(n)+'.png"><\/img>':"")+(typeof n!="undefined"?formatDateString(n):"")+"<\/label><\/div><\/div>"}function getDates(n,t){for(var r=[],i=n;i<=t;)r.push(new Date(i)),i=i.addDays(1);return r}function getDayOfWeek(n){return["Sun","Mon","Tue","Wen","Ths","Fri","Sat"][n.getDay()]}var idx,pairKeys;$(function(){fillSelects();$("#tabs").tabs({activate:function(n,t){idx=t.newTab.index();(idx===2||idx===3)&&(setTree(idx),$(".sticky").removeClass("sticky"),$(".sticky2").removeClass("sticky2"))}});setTree(getSelectedTabIndex());fillFooter();$("#TVProgProvider").change(function(){fillSelects();$("#TVProgrammeNowGrid").jqGrid("GridUnload");$("#TVProgrammeNextGrid").jqGrid("GridUnload");setGrids();setTree(getSelectedTabIndex());fillFooter()});$("#TVProgType").change(function(){$("#TVProgrammeNowGrid").jqGrid("GridUnload");$("#TVProgrammeNextGrid").jqGrid("GridUnload");setGrids();setTree(getSelectedTabIndex());fillFooter()});$("#TVProgCategories").change(function(){$("#TVProgrammeNowGrid").jqGrid("GridUnload");$("#TVProgrammeNextGrid").jqGrid("GridUnload");setGrids();idx===2?fillUserByDay(pairKeys[0],pairKeys[1]):idx===3&&fillUserByChannels(pairKeys[0],pairKeys[1])});fillGenresToolNow();fillGenresToolNext();fillGenresToolSearch();fillDatesToolSearch();$("#tabs").show();setGrids();$("#anonsTool").click(function(){$("#anonsDescr").toggle(100)});$("#anonsToolNext").click(function(){$("#anonsDescrNext").toggle(100)});$("#anonsToolSearch").click(function(){$("#anonsDescrSearch").toggle(100)});$("#anonsToolByDays").click(function(){$("#anonsDescrByDays").toggle(100)});$("#anonsToolByChannels").click(function(){$("#anonsDescrByChannels").toggle(100)});$("#btnSearch").click(function(){searchProgramme($("#TVProgType option:selected").val(),$("#tbContains").val())});$("#containerByDays").on("open_node.jstree",function(n,t){t.node.parents.length===3&&t.instance.set_icon(t.node,t.node.icon.indexOf("_exp")===-1?[t.node.icon.slice(0,11),"_exp",t.node.icon.slice(11)].join(""):t.node.icon)}).on("close_node.jstree",function(n,t){t.node.parents.length===3&&t.instance.set_icon(t.node,t.node.icon.replace("_exp",""))});$("#containerByDays").on("select_node.jstree",function(n,t){var r;if(t.node.parents.length===4){$("#pic").hide(100);$("#pic").attr("src",t.node.icon.replace("/small/","/large/"));$("#pic").show(100);$("#channelText").text(t.node.text);r=t.node.id;pairKeys=r.split("_");$("#dtFull").hide();var i=new Date(pairKeys[0].replace(/(\d+).(\d+).(\d+)/,"$2/$1/$3"));$("#dtFull").text(i.toLocaleDateString("ru-Ru",{day:"numeric"})+" "+["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][i.getMonth()]+" "+i.toLocaleDateString("ru-Ru",{year:"numeric"})+" ("+["Вс","Пн","Вт","Ср","Чт","Пт","Сб"][i.getDay()]+")");$("#dtFull").show();fillUserByDay(pairKeys[0],pairKeys[1])}});$("#containerByChannels").on("select_node.jstree",function(n,t){if(t.node.parents.length===4){var i=t.node.id;pairKeys=i.split("_");fillUserByChannels(pairKeys[0],pairKeys[1])}});$("#choicePnl").show();$("#dragToolGenreNow").draggable();$("#dragToolGenreNext").draggable();$("#dragToolGenreSearch").draggable()});Date.prototype.yyyymmdd=function(){var n=this.getMonth()+1,t=this.getDate();return[this.getFullYear(),(n>9?"":"0")+n,(t>9?"":"0")+t].join("")};Date.prototype.addDays=function(n){var t=new Date(this.valueOf());return t.setDate(t.getDate()+n),t};